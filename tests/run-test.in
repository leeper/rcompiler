#!/bin/sh
export PATH=@R_PREFIX@/lib/R/bin:$PATH
export LD_LIBRARY_PATH=@R_PREFIX@/lib/R/bin:@top_builddir@/lib/.libs
if [[ $1 == "" ]] ; then
  TEST=`echo test*.r`
  make ${TEST//\.r/.so} &&
  for i in test*\.so ; do
    echo --- $i --- &&
    echo '     - R -' &&
    R --vanilla --slave < `echo $i | sed 's/\.so/.r/'` &&
    echo '     - C -' &&
    echo 'dyn.load("'$i'")' | R --vanilla --slave &&
    true
  done ;
else
  TEST=`echo test$1_*.r`
  make ${TEST/\.r/.so} &&
  echo --- R --- &&
  R --vanilla --slave < ${TEST} &&
  echo --- C --- &&
  echo 'dyn.load("'`ls test$1_*.so`'")' | R --vanilla --slave &&
  true ;
fi
