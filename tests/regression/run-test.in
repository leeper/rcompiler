#!/bin/sh
# @configure_input@
trap 'echo "Testing halted" ; exit' SIGINT
export PATH=@R_PREFIX@/lib/R/bin:$PATH
export LD_LIBRARY_PATH=@R_PREFIX@/lib/R/bin:@top_builddir@/lib/.libs
if [[ $1 == "" ]] ; then
  TEST=`echo *.r`
  make ${TEST//\.r/.so}                                   \
  && for i in *\.so ; do
       echo --- $i ---                                    \
    && echo '     - R -'                                  \
    && R --slave < `echo $i | sed 's/\.so/.r/'`           \
    && echo '     - C -'                                  \
    && echo 'dyn.load("'$i'")' | R --slave                \
    && true
  done ;
else
  TEST=$1
  TEST_SO=${TEST/.r/.so}
  make ${TEST_SO}                                          \
  && echo --- R ---                                        \
  && R --slave < ${TEST}                                   \
  && echo --- C ---                                        \
  && echo 'dyn.load("'${TEST_SO}'")' | R --slave           \
  && true                                                  \
  ;
fi
